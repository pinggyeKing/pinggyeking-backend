<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Excuse Management Dashboard</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="min-h-screen bg-gray-50">
<!-- Header -->
<div class="bg-white shadow-sm border-b">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Excuse Management Dashboard</h1>
        <p class="text-sm text-gray-600">AI 생성 변명 시스템 관리</p>
      </div>
      <div class="flex space-x-3">
        <button onclick="refreshData()" class="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          <i class="fas fa-sync-alt w-4 h-4 mr-2"></i>
          새로고침
        </button>
        <button onclick="exportData()" class="flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
          <i class="fas fa-download w-4 h-4 mr-2"></i>
          내보내기
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Navigation Tabs -->
<div class="bg-white shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex space-x-8">
      <button onclick="showTab('overview')" class="tab-button active flex items-center px-4 py-4 border-b-2 font-medium text-sm transition-colors border-blue-500 text-blue-600">
        <i class="fas fa-chart-line w-4 h-4 mr-2"></i>
        대시보드
      </button>
      <button onclick="showTab('excuses')" class="tab-button flex items-center px-4 py-4 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700">
        <i class="fas fa-database w-4 h-4 mr-2"></i>
        변명 관리
      </button>
      <button onclick="showTab('analytics')" class="tab-button flex items-center px-4 py-4 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700">
        <i class="fas fa-chart-bar w-4 h-4 mr-2"></i>
        분석
      </button>
    </div>
  </div>
</div>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Overview Tab -->
  <div id="overview-tab" class="tab-content space-y-8">
    <!-- Key Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600 mb-1">총 변명 수</p>
            <p class="text-2xl font-bold text-gray-800" th:text="${stats.totalExcuses}">15,847</p>
            <p class="text-sm text-green-600">+12.5% vs last period</p>
          </div>
          <div class="p-3 rounded-full bg-blue-100">
            <i class="fas fa-database text-blue-600"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600 mb-1">오늘 생성된 변명</p>
            <p class="text-2xl font-bold text-gray-800" th:text="${stats.todayExcuses}">234</p>
            <p class="text-sm text-green-600">+8.3% vs yesterday</p>
          </div>
          <div class="p-3 rounded-full bg-green-100">
            <i class="fas fa-calendar text-green-600"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-yellow-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600 mb-1">평균 신뢰도 점수</p>
            <p class="text-2xl font-bold text-gray-800" th:text="${stats.avgCredibilityScore}">7.2</p>
            <p class="text-sm text-red-600">-2.1% vs last period</p>
          </div>
          <div class="p-3 rounded-full bg-yellow-100">
            <i class="fas fa-star text-yellow-600"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600 mb-1">평균 응답 시간</p>
            <p class="text-2xl font-bold text-gray-800" th:text="${stats.avgResponseTime + 'ms'}">1,247ms</p>
            <p class="text-sm text-green-600">-15.2% improvement</p>
          </div>
          <div class="p-3 rounded-full bg-purple-100">
            <i class="fas fa-clock text-purple-600"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600 mb-1">사용된 토큰 수</p>
            <p class="text-2xl font-bold text-gray-800" th:text="${stats.totalTokensUsed}">892,341</p>
            <p class="text-sm text-green-600">+23.7% vs last period</p>
          </div>
          <div class="p-3 rounded-full bg-red-100">
            <i class="fas fa-bolt text-red-600"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-indigo-500">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-600 mb-1">활성 사용자</p>
            <p class="text-2xl font-bold text-gray-800" th:text="${stats.activeUsers}">3,421</p>
            <p class="text-sm text-green-600">+5.8% vs last period</p>
          </div>
          <div class="p-3 rounded-full bg-indigo-100">
            <i class="fas fa-users text-indigo-600"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Daily Usage Chart -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">일일 사용량 추이</h3>
        <div class="h-64">
          <canvas id="dailyUsageChart"></canvas>
        </div>
      </div>

      <!-- Category Distribution -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">카테고리별 분포</h3>
        <div class="h-64">
          <canvas id="categoryChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Recent Excuses Table -->
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold mb-4">최근 생성된 변명</h3>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">변명</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상황</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">대상</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">카테고리</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">신뢰도</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">생성시간</th>
          </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
          <tr th:each="excuse : ${recentExcuses}" class="hover:bg-gray-50">
            <td class="px-6 py-4 text-sm text-gray-900 max-w-xs" th:text="${excuse.excuse}">변명 내용</td>
            <td class="px-6 py-4 text-sm text-gray-600" th:text="${excuse.situation}">상황</td>
            <td class="px-6 py-4 text-sm text-gray-600" th:text="${excuse.target}">대상</td>
            <td class="px-6 py-4 text-sm">
              <span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full" th:text="${excuse.category}">카테고리</span>
            </td>
            <td class="px-6 py-4 text-sm text-gray-900 font-medium" th:text="${excuse.credibilityScore}">8.5</td>
            <td class="px-6 py-4 text-sm text-gray-500" th:text="${excuse.createdAt}">2025-01-14 09:23:45</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Analytics Tab -->
  <div id="analytics-tab" class="tab-content space-y-8 hidden">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">신뢰도 점수 분포</h3>
        <div class="h-64">
          <canvas id="credibilityChart"></canvas>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">톤별 사용량</h3>
        <div class="h-64">
          <canvas id="toneChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Excuses Management Tab -->
  <div id="excuses-tab" class="tab-content space-y-8 hidden">
    <div class="bg-white rounded-lg shadow-md p-6">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">변명 관리</h3>
        <div class="flex space-x-2">
          <input type="text" placeholder="검색..." class="px-3 py-2 border border-gray-300 rounded-lg">
          <select class="px-3 py-2 border border-gray-300 rounded-lg">
            <option value="all">모든 카테고리</option>
            <option th:each="category : ${categories}" th:value="${category}" th:text="${category}">카테고리</option>
          </select>
        </div>
      </div>
      <div class="text-center py-8 text-gray-500">
        <p>검색 기능과 필터링이 여기에 구현됩니다.</p>
      </div>
    </div>
  </div>
</div>

<script>
  // Tab functionality
  function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
      tab.classList.add('hidden');
    });

    // Remove active class from all buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
      btn.classList.add('border-transparent', 'text-gray-500');
    });

    // Show selected tab
    document.getElementById(tabName + '-tab').classList.remove('hidden');

    // Add active class to selected button
    event.target.closest('.tab-button').classList.add('active', 'border-blue-500', 'text-blue-600');
    event.target.closest('.tab-button').classList.remove('border-transparent', 'text-gray-500');
  }

  // Chart data from Thymeleaf
  const dailyUsageData = /*[[${dailyUsageData}]]*/ [
    { date: '01-08', excuses: 187 },
    { date: '01-09', excuses: 234 },
    { date: '01-10', excuses: 312 },
    { date: '01-11', excuses: 278 },
    { date: '01-12', excuses: 298 },
    { date: '01-13', excuses: 345 },
    { date: '01-14', excuses: 234 }
  ];

  const categoryData = /*[[${categoryData}]]*/ [
    { name: 'Work', value: 4521 },
    { name: 'School', value: 3892 },
    { name: 'Personal', value: 2847 },
    { name: 'Social', value: 2156 },
    { name: 'Health', value: 1847 }
  ];

  // Daily Usage Chart
  const dailyCtx = document.getElementById('dailyUsageChart').getContext('2d');
  new Chart(dailyCtx, {
    type: 'line',
    data: {
      labels: dailyUsageData.map(d => d.date),
      datasets: [{
        label: '일일 변명 생성수',
        data: dailyUsageData.map(d => d.excuses),
        borderColor: 'rgb(59, 130, 246)',
        backgroundColor: 'rgba(59, 130, 246, 0.1)',
        fill: true,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  // Category Pie Chart
  const categoryCtx = document.getElementById('categoryChart').getContext('2d');
  new Chart(categoryCtx, {
    type: 'doughnut',
    data: {
      labels: categoryData.map(d => d.name),
      datasets: [{
        data: categoryData.map(d => d.value),
        backgroundColor: [
          '#8884d8',
          '#82ca9d',
          '#ffc658',
          '#ff7300',
          '#8dd1e1'
        ]
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom'
        }
      }
    }
  });

  // Credibility Distribution Chart
  const credibilityCtx = document.getElementById('credibilityChart').getContext('2d');
  new Chart(credibilityCtx, {
    type: 'bar',
    data: {
      labels: ['0-2', '2-4', '4-6', '6-8', '8-10'],
      datasets: [{
        label: '변명 수',
        data: [234, 567, 2134, 5847, 7065],
        backgroundColor: 'rgba(59, 130, 246, 0.8)'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  // Tone Chart
  const toneCtx = document.getElementById('toneChart').getContext('2d');
  new Chart(toneCtx, {
    type: 'bar',
    data: {
      labels: ['Formal', 'Casual', 'Apologetic', 'Confident'],
      datasets: [{
        label: '사용 횟수',
        data: [5847, 4521, 3189, 2290],
        backgroundColor: 'rgba(34, 197, 94, 0.8)'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  // Utility functions
  function refreshData() {
    location.reload();
  }

  function exportData() {
    alert('데이터를 내보내는 중...');
  }
</script>
</body>
</html>